<hlm-sidebar [collapsible]="'icon'">
  <!-- Header -->
  <div hlmSidebarHeader>
    <div
      class="flex items-center gap-2 pt-2 pr-1 pl-2 group-data-[collapsible=icon]:justify-center group-data-[collapsible=icon]:p-0"
    >
      <!-- Toggle button (only visible when collapsed) -->
      <button
        hlmSidebarTrigger
        class="text-primary hidden group-data-[collapsible=icon]:flex"
        aria-label="Expand sidebar"
      >
        <ng-icon hlm name="lucideMenu" size="sm" />
      </button>

      <!-- Logo + Title (clickable, hidden when collapsed) -->
      <a
        routerLink="/"
        class="flex items-center gap-2 group-data-[collapsible=icon]:hidden"
      >
        <div
          class="bg-primary text-primary-foreground flex h-8 w-8 shrink-0 items-center justify-center rounded-lg"
        >
          <ng-icon hlm name="lucideSparkle" size="sm" />
        </div>
        <span class="text-sm font-semibold">Angular AI Kit</span>
      </a>

      <!-- Spacer (hidden when collapsed) -->
      <div class="flex-1 group-data-[collapsible=icon]:hidden"></div>

      <!-- Sidebar Toggle -->
      <button
        hlmSidebarTrigger
        class="text-primary group-data-[collapsible=icon]:hidden"
      >
        <span class="sr-only">Toggle sidebar</span>
      </button>
    </div>

    <!-- Search Trigger (hidden when collapsed) -->
    <div class="px-2 pt-2 group-data-[collapsible=icon]:hidden">
      <app-search-trigger />
    </div>
  </div>

  <!-- Content -->
  <div hlmSidebarContent>
    <!-- Navigation Links -->
    <div hlmSidebarGroup>
      <div hlmSidebarGroupContent>
        <ul hlmSidebarMenu>
          @if (isDocsPage()) {
            <!-- Live Demo (shown on docs pages) -->
            <li hlmSidebarMenuItem>
              <a hlmSidebarMenuButton routerLink="/">
                <ng-icon hlm name="lucideSparkle" size="sm" />
                <span>Live Demo</span>
              </a>
            </li>
          } @else {
            <!-- Documentation (shown on chat page) -->
            <li hlmSidebarMenuItem>
              <a
                hlmSidebarMenuButton
                routerLink="/docs"
                routerLinkActive="bg-accent"
                [routerLinkActiveOptions]="{ exact: true }"
              >
                <ng-icon hlm name="lucideBook" size="sm" />
                <span>Documentation</span>
              </a>
            </li>
          }

          <!-- GitHub -->
          <li hlmSidebarMenuItem>
            <a
              hlmSidebarMenuButton
              href="https://github.com/hassantayyab/angular-ai-kit"
              target="_blank"
              rel="noopener noreferrer"
            >
              <ng-icon hlm name="lucideGithub" size="sm" />
              <span>GitHub</span>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <div
      hlmSidebarSeparator
      class="mx-auto mb-0 group-data-[collapsible=icon]:hidden"
    ></div>

    @if (isDocsPage()) {
      <!-- Documentation Navigation (for Docs page) - Hidden when collapsed -->
      <div
        hlmSidebarGroup
        class="mt-0 flex-1 overflow-y-auto group-data-[collapsible=icon]:hidden"
      >
        <div hlmSidebarGroupContent>
          @for (category of docsNavigation; track category.label) {
            <hlm-collapsible [expanded]="true" class="group/collapsible">
              <ul hlmSidebarMenu>
                <li hlmSidebarMenuItem>
                  <button
                    hlmCollapsibleTrigger
                    hlmSidebarMenuButton
                    class="w-full"
                  >
                    <span class="font-medium">{{ category.label }}</span>
                    <ng-icon
                      hlm
                      name="lucideChevronRight"
                      size="sm"
                      class="ml-auto transition-transform group-data-[state=open]/collapsible:rotate-90"
                    />
                  </button>

                  <hlm-collapsible-content>
                    <ul hlmSidebarMenuSub>
                      @for (item of category.items; track item.name) {
                        <li hlmSidebarMenuSubItem>
                          <a
                            hlmSidebarMenuSubButton
                            [routerLink]="item.route"
                            routerLinkActive="bg-accent"
                            [routerLinkActiveOptions]="{ exact: true }"
                            [title]="item.label"
                            (click)="handleComponentSelect(item.route)"
                          >
                            {{ item.label }}
                          </a>
                        </li>
                      }
                    </ul>
                  </hlm-collapsible-content>
                </li>
              </ul>
            </hlm-collapsible>
          }
        </div>
      </div>
    } @else {
      <!-- Chat Section (for Chat page) -->
      <div hlmSidebarGroup class="mt-0 flex-1">
        <div hlmSidebarGroupLabel>Chat</div>
        <div hlmSidebarGroupContent>
          <ul hlmSidebarMenu>
            <!-- New Chat Button -->
            <li hlmSidebarMenuItem>
              <button hlmSidebarMenuButton (click)="handleNewConversation()">
                <ng-icon hlm name="lucidePlus" size="sm" />
                <span>New Chat</span>
              </button>
            </li>

            <!-- Chat History (Collapsible) -->
            <hlm-collapsible
              [expanded]="true"
              class="group/collapsible group-data-[collapsible=icon]:hidden"
            >
              <li hlmSidebarMenuItem>
                <button
                  hlmCollapsibleTrigger
                  hlmSidebarMenuButton
                  class="w-full"
                >
                  <ng-icon hlm name="lucideClock" size="sm" />
                  <span>Chat History</span>
                  <ng-icon
                    hlm
                    name="lucideChevronRight"
                    size="sm"
                    class="ml-auto transition-transform group-data-[state=open]/collapsible:rotate-90"
                  />
                </button>

                <hlm-collapsible-content>
                  <ul hlmSidebarMenuSub>
                    @for (group of conversationGroups(); track group.label) {
                      @for (
                        conversation of group.conversations;
                        track conversation.id
                      ) {
                        <li hlmSidebarMenuSubItem class="group/item relative">
                          <button
                            hlmSidebarMenuSubButton
                            [attr.data-active]="
                              isActiveConversation(conversation.id)
                            "
                            [title]="conversation.title"
                            (click)="handleConversationSelect(conversation.id)"
                            class="w-full"
                          >
                            <span
                              class="truncate transition-[padding] group-hover/item:pr-7"
                            >
                              {{ conversation.title }}
                            </span>
                          </button>

                          <!-- Delete button (on hover) -->
                          <ai-icon-button
                            icon="lucideTrash2"
                            ariaLabel="Delete conversation"
                            size="sm"
                            variant="ghost"
                            customClasses="absolute top-1/2 right-1 hidden -translate-y-1/2 group-hover/item:inline-flex group-data-[collapsible=icon]:hidden hover:bg-accent hover:text-foreground"
                            (clicked)="
                              handleDeleteConversation($event, conversation.id)
                            "
                          />
                        </li>
                      }
                    } @empty {
                      <!-- Empty state -->
                      <li
                        class="px-2 py-4 text-center group-data-[collapsible=icon]:hidden"
                      >
                        <p class="text-muted-foreground text-sm">
                          No conversations yet
                        </p>
                      </li>
                    }
                  </ul>
                </hlm-collapsible-content>
              </li>
            </hlm-collapsible>
          </ul>
        </div>
      </div>
    }
  </div>

  <!-- Footer -->
  <div hlmSidebarFooter>
    <div
      class="flex items-center justify-between group-data-[collapsible=icon]:justify-center"
    >
      <span
        class="text-muted-foreground text-xs group-data-[collapsible=icon]:hidden"
      >
        {{ appVersion }}
      </span>
      <app-theme-toggle />
    </div>
  </div>
</hlm-sidebar>
