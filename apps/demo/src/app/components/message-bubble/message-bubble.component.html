<article
  [class]="containerClasses()"
  role="article"
  [attr.aria-label]="ariaLabel()"
>
  <!-- Avatar with icon -->
  @if (showAvatar()) {
    <hlm-avatar size="sm" class="shrink-0">
      <span
        hlmAvatarFallback
        [class]="avatarFallbackClasses()"
        class="flex items-center justify-center"
      >
        <ng-icon hlm [name]="avatarIcon()" size="sm" />
      </span>
    </hlm-avatar>
  }

  <!-- Content section -->
  <div [class]="contentClasses()">
    <!-- Message text (with streaming support) -->
    @if (isStreaming()) {
      <app-streaming-text
        [content]="message().content"
        [isStreaming]="true"
        [speed]="20"
        [showCursor]="true"
      />
    } @else {
      <p>{{ message().content }}</p>
    }

    <!-- Actions (shown on hover, focus, or when showActions is true) -->
    <div [class]="actionsClasses()" [attr.aria-hidden]="!actionsVisible()">
      <!-- Copy button with tooltip -->
      <button
        type="button"
        hlmBtn
        variant="ghost"
        size="icon"
        [class]="actionButtonClasses()"
        hlmTooltipTrigger="Copy message"
        [attr.aria-label]="'Copy message'"
        [attr.tabindex]="actionsVisible() ? 0 : -1"
        (click)="handleCopy()"
      >
        <ng-icon hlm name="lucideCopy" size="sm" />
        <span class="sr-only">Copy</span>
      </button>

      <!-- Regenerate button (only for assistant messages) -->
      @if (isAssistantMessage()) {
        <button
          type="button"
          hlmBtn
          variant="ghost"
          size="icon"
          [class]="actionButtonClasses()"
          hlmTooltipTrigger="Regenerate response"
          [attr.aria-label]="'Regenerate message'"
          [attr.tabindex]="actionsVisible() ? 0 : -1"
          (click)="handleRegenerate()"
        >
          <ng-icon hlm name="lucideRefreshCw" size="sm" />
          <span class="sr-only">Regenerate</span>
        </button>
      }
    </div>
  </div>
</article>
