<article
  [class]="containerClasses()"
  role="article"
  [attr.aria-label]="ariaLabel()"
>
  <!-- Avatar -->
  @if (showAvatar()) {
    <div [class]="avatarClasses()">
      <hlm-avatar>
        <span hlmAvatarFallback class="bg-muted text-muted-foreground">
          <ng-icon hlm name="lucideUser" size="sm" />
        </span>
      </hlm-avatar>
    </div>
  }

  <!-- Content Wrapper -->
  <div class="text-right">
    <!-- Message Card -->
    <div [class]="cardClasses()" class="text-left">
      @if (isEditing()) {
        <!-- Edit Mode -->
        <textarea
          #editTextarea
          id="ai-user-message-edit"
          name="ai-user-message-edit"
          [class]="textareaClasses()"
          [value]="editContent()"
          (input)="handleEditInput($event)"
          (keydown)="handleEditKeydown($event)"
          rows="3"
          aria-label="Edit message"
        ></textarea>

        <!-- Edit Actions -->
        <div class="mt-2 flex justify-end gap-2">
          <button
            type="button"
            class="text-muted-foreground hover:bg-accent hover:text-foreground cursor-pointer rounded px-3 py-1 text-sm transition-colors"
            (click)="cancelEdit()"
          >
            Cancel
          </button>
          <button
            type="button"
            class="bg-primary text-primary-foreground hover:bg-primary/90 cursor-pointer rounded px-3 py-1 text-sm transition-colors"
            (click)="saveEdit()"
          >
            Save
          </button>
        </div>
      } @else {
        <!-- Display Mode -->
        <p [class]="contentClasses()">{{ displayContent() }}</p>

        <!-- Show More / Show Less -->
        @if (isLongMessage()) {
          <button
            type="button"
            class="text-muted-foreground mt-1 block cursor-pointer text-xs hover:underline"
            (click)="toggleExpand()"
          >
            {{ isExpanded() ? 'Show less' : 'Show more' }}
          </button>
        }
      }
    </div>

    <!-- Action Buttons via MessageActions -->
    @if (!isEditing()) {
      <div [class]="actionsWrapperClasses()">
        <ai-message-actions
          [content]="message().content"
          [showCopy]="showCopy()"
          [showEdit]="showEdit()"
          [isVisible]="actionsVisible()"
          (copy)="handleCopy()"
          (edit)="startEdit()"
        />
      </div>
    }
  </div>
</article>
