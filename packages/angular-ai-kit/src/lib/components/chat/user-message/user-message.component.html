<article
  [class]="containerClasses()"
  role="article"
  [attr.aria-label]="ariaLabel()"
>
  <!-- Message Card -->
  <div [class]="cardClasses()">
    @if (isEditing()) {
      <!-- Edit Mode -->
      <textarea
        #editTextarea
        [class]="textareaClasses()"
        [value]="editContent()"
        (input)="handleEditInput($event)"
        (keydown)="handleEditKeydown($event)"
        rows="3"
        aria-label="Edit message"
      ></textarea>

      <!-- Edit Actions -->
      <div class="mt-2 flex justify-end gap-2">
        <button
          type="button"
          class="text-muted-foreground hover:bg-accent hover:text-foreground cursor-pointer rounded px-3 py-1 text-sm transition-colors"
          (click)="cancelEdit()"
        >
          Cancel
        </button>
        <button
          type="button"
          class="bg-primary text-primary-foreground hover:bg-primary/90 cursor-pointer rounded px-3 py-1 text-sm transition-colors"
          (click)="saveEdit()"
        >
          Save
        </button>
      </div>
    } @else {
      <!-- Display Mode -->
      <p [class]="contentClasses()">{{ displayContent() }}</p>

      <!-- Show More / Show Less -->
      @if (isLongMessage()) {
        <button
          type="button"
          class="text-muted-foreground mt-1 block cursor-pointer text-xs hover:underline"
          (click)="toggleExpand()"
        >
          {{ isExpanded() ? 'Show less' : 'Show more' }}
        </button>
      }
    }
  </div>

  <!-- Action Buttons (visible on hover) -->
  @if (!isEditing()) {
    <div [class]="actionsClasses()" [attr.aria-hidden]="!actionsVisible()">
      <!-- Copy Button -->
      <ai-icon-button
        [icon]="copyIcon()"
        ariaLabel="Copy message"
        size="sm"
        (clicked)="handleCopy()"
      />

      <!-- Edit Button -->
      <ai-icon-button
        icon="lucidePencil"
        ariaLabel="Edit message"
        size="sm"
        (clicked)="startEdit()"
      />
    </div>
  }
</article>
